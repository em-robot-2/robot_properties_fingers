<?xml version="1.0" ?>
<robot name="manipulator"
       xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
       xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
       xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
       xmlns:xacro="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface">

    <xacro:property name="material_name" value="material"/>
    <xacro:property name="color" value="0.6 0.6 1.0"/>
    <xacro:property name="opacity" value="1.0"/>

    <!-- Meshes -->
    <xacro:property name="mesh_file_extension" value="stl"/>
    <xacro:property name="mesh_dir" value="package://robot_properties_manipulator/meshes/${mesh_file_extension}"/>
    <xacro:property name="base_mesh" value="${mesh_dir}/SIM__BL-Finger_Base.${mesh_file_extension}"/>
    <xacro:property name="base_holder_mesh" value="${mesh_dir}/BL_Finger_Holder_SIM.${mesh_file_extension}"/>
    <xacro:property name="base_stage_mesh" value="${mesh_dir}/Stage_simplified.${mesh_file_extension}"/>
    <xacro:property name="proximal_mesh" value="${mesh_dir}/SIM__BL-Finger_Proximal.${mesh_file_extension}"/>
    <xacro:property name="central_mesh" value="${mesh_dir}/SIM__BL-Finger_Intermediate.${mesh_file_extension}"/>
    <xacro:property name="distal_mesh" value="${mesh_dir}/SIM_BL_FINGER_TIP_LINK.${mesh_file_extension}"/>
    <xacro:property name="distal_padding_mesh" value="${mesh_dir}/finger_padding.${mesh_file_extension}"/>
    
    <!-- Proximal link Inertia -->
    <xacro:property name="proximal_x" value="0.0399"/>
    <xacro:property name="proximal_y" value="0.2115"/>
    <xacro:property name="proximal_z" value="0.047138" />
    <xacro:property name="proximal_m" value="0.180" />
    
    <!-- Intermediate link Inertia -->
    <xacro:property name="intermediate_x" value="0.0419"/>
    <xacro:property name="intermediate_y" value="0.206"/>
    <xacro:property name="intermediate_z" value="0.044276" />
    <xacro:property name="intermediate_m" value="0.180" />
    
    <!-- Tip link Inertia -->
    <xacro:property name="tip_x" value="0.027317"/>
    <xacro:property name="tip_y" value="0.183"/>
    <xacro:property name="tip_z" value="0.024" />
    <xacro:property name="tip_m" value="0.02" />
    
    <mujoco>
        <compiler meshdir="../meshes/${mesh_file_extension}/" balanceinertia="true" discardvisual="false" />
    </mujoco>

    <xacro:macro name="my_link" params="name origin_rpy origin_xyz
                                        mesh_file x y z m">
        <link name="${name}">
            <inertial>
                <origin rpy="0 0 0" xyz="0 0 0"/>
                <mass value="${m}"/>
                <inertia ixx="${1./12. * m * (y*y + z*z)}"
                         iyy="${1./12. * m * (x*x + z*z)}"
                         izz="${1./12. * m * (x*x + y*y)}"
                         ixy="0" ixz="0" iyz="0"
                />
            </inertial>
            <visual>
                <origin rpy="${origin_rpy}" xyz="${origin_xyz}"/>
                <geometry>
                    <mesh filename="${mesh_file}"/>
                </geometry>
                <material name="${material_name}">
                    <color rgba="${color} ${opacity}"/>
                </material>
            </visual>
            <collision>
                <origin rpy="${origin_rpy}" xyz="${origin_xyz}"/>
                <geometry>
                    <mesh filename="${mesh_file}"/>
                </geometry>
                <material name="${material_name}">
                    <color rgba="${color} ${opacity}"/>
                </material>
            </collision>
        </link>
    </xacro:macro>

    <!-- World Link -->
    <link name="world"/>
    <xacro:my_link
            name="holder_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${base_holder_mesh}"
            x="0.1"
            y="0.1"
            z="0.1"
            m="0.1"/>
    <xacro:my_link
            name="stage_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${base_stage_mesh}"
            x="0.5"
            y="0.5"
            z="0.1"
            m="5"/>
    <xacro:my_link
            name="proximal_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${proximal_mesh}"
            x="${proximal_x}"
            y="${proximal_y}"
            z="${proximal_z}"
            m="${proximal_m}"/>
    <xacro:my_link
            name="intermediate_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${central_mesh}"
            x="${intermediate_x}"
            y="${intermediate_y}"
            z="${intermediate_z}"
            m="${intermediate_m}"/>
    <xacro:my_link
            name="base_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${base_mesh}"
            x="0.1"
            y="0.1"
            z="0.1"
            m="0.1"/>
    <xacro:my_link
            name="tip_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${distal_mesh}"
            x="${tip_x}"
            y="${tip_y}"
            z="${tip_z}"
            m="${tip_m}"/>
    <xacro:my_link
            name="padding_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${distal_padding_mesh}"
            x="0.01"
            y="0.01"
            z="0.01"
            m="0.005"/>



    <joint name="holder_joint" type="fixed">
        <parent link="world"/>
        <child link="holder_link"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>
    <joint name="holder_to_stage" type="fixed">
        <parent link="holder_link"/>
        <child link="stage_link"/>
        <origin xyz="0 0 -0.2665"/>
    </joint>
    <joint name="holder_to_proximal" type="revolute">
        <parent link="holder_link"/>
        <child link="proximal_link"/>
        <limit effort="1000" lower="0" upper="3.14159265359" velocity="1000"/>
        <axis rpy="0 0 0" xyz="0 1 0"/>
        <origin rpy="0 -1.5708 0" xyz="0 0 0"/>
    </joint>
    <joint name="holder_to_base" type="fixed">
        <parent link="holder_link"/>
        <child link="base_link"/>
        <origin xyz="0 0.20595 0"/>
    </joint>
    <joint name="proximal_to_intermediate" type="revolute">
        <parent link="proximal_link"/>
        <child link="intermediate_link"/>
        <limit effort="1000" lower="-5.846853" upper="0" velocity="1000"/>
        <axis rpy="0 0 0" xyz="-1 0 0"/>
        <origin rpy="2.9234265 0 0" xyz="0.014 0.02695 0"/>
    </joint>
    <joint name="intermediate_to_tip" type="revolute">
        <parent link="intermediate_link"/>
        <child link="tip_link"/>
        <limit effort="1000" lower="0" upper="6.00394" velocity="1000"/>
        <axis rpy="0 0 0" xyz="1 0 0"/>
        <origin rpy="-2.9 0 0" xyz="0 -0.16 0"/>
    </joint>
    <joint name="tip_to_padding" type="fixed">
        <parent link="tip_link"/>
        <child link="padding_link"/>
        <origin xyz="-0.0125 -0.16 0"/>
    </joint>



</robot>
