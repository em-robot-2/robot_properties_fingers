<?xml version="1.0" ?>
<robot name="manipulator"
       xmlns:controller="http://playerstage.sourceforge.net/gazebo/xmlschema/#controller"
       xmlns:interface="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface"
       xmlns:sensor="http://playerstage.sourceforge.net/gazebo/xmlschema/#sensor"
       xmlns:xacro="http://playerstage.sourceforge.net/gazebo/xmlschema/#interface">

    <xacro:property name="material_name" value="material"/>
    <xacro:property name="color" value="0.6 0.6 1.0"/>
    <xacro:property name="opacity" value="1.0"/>

    <!-- Meshes -->
    <xacro:property name="mesh_file_extension" value="stl"/>
    <xacro:property name="mesh_dir" value="package://robot_properties_manipulator/meshes/${mesh_file_extension}"/>
    <xacro:property name="base_mesh" value="${mesh_dir}/SIM__BL-Finger_Base.${mesh_file_extension}"/>
    <xacro:property name="base_holder_mesh" value="${mesh_dir}/BL_Finger_Holder_SIM.${mesh_file_extension}"/>
    <xacro:property name="base_stage_mesh" value="${mesh_dir}/Stage_simplified.${mesh_file_extension}"/>
    <xacro:property name="proximal_mesh" value="${mesh_dir}/SIM__BL-Finger_Proximal.${mesh_file_extension}"/>
    <xacro:property name="central_mesh" value="${mesh_dir}/SIM__BL-Finger_Intermediate.${mesh_file_extension}"/>
    <xacro:property name="distal_mesh" value="${mesh_dir}/SIM_BL_FINGER_TIP_LINK.${mesh_file_extension}"/>
    <xacro:property name="distal_padding_mesh" value="${mesh_dir}/finger_padding.${mesh_file_extension}"/>
    


    <!-- Some macros for convenience -->
    <xacro:macro name="add_geometry" params="origin_rpy origin_xyz mesh_file">
        <visual>
            <origin rpy="${origin_rpy}" xyz="${origin_xyz}"/>
            <geometry>
                <mesh filename="${mesh_file}"/>
            </geometry>
            <material name="${material_name}">
                <color rgba="${color} ${opacity}"/>
            </material>
        </visual>
        <collision>
            <origin rpy="${origin_rpy}" xyz="${origin_xyz}"/>
            <geometry>
                <mesh filename="${mesh_file}"/>
            </geometry>
            <material name="${material_name}">
                <color rgba="${color} ${opacity}"/>
            </material>
        </collision>
    </xacro:macro>

    <xacro:macro name="add_inertia" params="x y z m">
        <inertial>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <mass value="${m}"/>
            <inertia ixx="${1./12. * m * (y*y + z*z)}"
                        iyy="${1./12. * m * (x*x + z*z)}"
                        izz="${1./12. * m * (x*x + y*y)}"
                        ixy="0" ixz="0" iyz="0"/>
        </inertial>
    </xacro:macro>

    <xacro:macro name="dynamic_link" params="name origin_rpy origin_xyz
                                        mesh_file x y z m">
        <link name="${name}">
            <inertial>
                <origin rpy="0 0 0" xyz="0 0 0"/>
                <mass value="${m}"/>
                <inertia ixx="${1./12. * m * (y*y + z*z)}"
                         iyy="${1./12. * m * (x*x + z*z)}"
                         izz="${1./12. * m * (x*x + y*y)}"
                         ixy="0" ixz="0" iyz="0"/>
            </inertial>
            <visual>
                <origin rpy="${origin_rpy}" xyz="${origin_xyz}"/>
                <geometry>
                    <mesh filename="${mesh_file}"/>
                </geometry>
                <material name="${material_name}">
                    <color rgba="${color} ${opacity}"/>
                </material>
            </visual>
            <collision>
                <origin rpy="${origin_rpy}" xyz="${origin_xyz}"/>
                <geometry>
                    <mesh filename="${mesh_file}"/>
                </geometry>
                <material name="${material_name}">
                    <color rgba="${color} ${opacity}"/>
                </material>
            </collision>
        </link>
    </xacro:macro>

    <!-- base link -->
    <link name="base_link">
        <xacro:add_geometry
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${base_mesh}"/>
    </link>
    <link name="base_holder_link">
        <xacro:add_geometry
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${base_holder_mesh}"/>
    </link>
    <link name="base_stage_link">
        <xacro:add_geometry
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${base_stage_mesh}"/>
    </link>
    <joint name="base_holder_to_stage" type="fixed">
        <parent link="base_holder_link"/>
        <child link="base_stage_link"/>
        <origin xyz="0 0 -0.2665"/>
    </joint>
    <joint name="base_holder_to_base" type="fixed">
        <parent link="base_holder_link"/>
        <child link="base_link"/>
        <origin xyz="0 0.20595 0"/>
    </joint>


    <!-- proximal link -->
    <xacro:dynamic_link
            name="proximal_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${proximal_mesh}"
            x="0.0399"
            y="0.2115"
            z="0.047138"
            m="0.180"/>

    <!-- central link -->
    <xacro:dynamic_link
            name="intermediate_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${central_mesh}"
            x="0.0419"
            y="0.206"
            z="0.044276"
            m="0.180"/>

    <!-- distal link -->
    <xacro:dynamic_link
            name="tip_link"
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${distal_mesh}"
            x="0.027317"
            y="0.183"
            z="0.024"
            m="0.02"/>
    <link name="padding_link">
        <xacro:add_geometry
            origin_rpy="0 0 0"
            origin_xyz="0 0 0"
            mesh_file="${distal_padding_mesh}"/>
    </link>
    <joint name="tip_to_padding" type="fixed">
        <parent link="tip_link"/>
        <child link="padding_link"/>
        <origin xyz="-0.0125 -0.16 0"/>
    </joint>

    <!-- kinematics -->
    <joint name="holder_to_proximal" type="revolute">
        <parent link="base_holder_link"/>
        <child link="proximal_link"/>
        <limit effort="1000" lower="0" upper="3.14159265359" velocity="1000"/>
        <axis rpy="0 0 0" xyz="0 1 0"/>
        <origin rpy="0 -1.5708 0" xyz="0 0 0"/>
    </joint>
    <joint name="proximal_to_intermediate" type="revolute">
        <parent link="proximal_link"/>
        <child link="intermediate_link"/>
        <limit effort="1000" lower="-5.846853" upper="0" velocity="1000"/>
        <axis rpy="0 0 0" xyz="-1 0 0"/>
        <origin rpy="2.9234265 0 0" xyz="0.014 0.02695 0"/>
    </joint>
    <joint name="intermediate_to_tip" type="revolute">
        <parent link="intermediate_link"/>
        <child link="tip_link"/>
        <limit effort="1000" lower="0" upper="6.00394" velocity="1000"/>
        <axis rpy="0 0 0" xyz="1 0 0"/>
        <origin rpy="-2.9 0 0" xyz="0 -0.16 0"/>
    </joint>




</robot>
